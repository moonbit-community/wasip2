// Generated by `wit-bindgen` 0.49.0. DO NOT EDIT!

///|
pub(all) struct ResolveAddressStream(Int) derive(Show, Eq)

///|
/// Drops a resource handle.
pub fn ResolveAddressStream::drop(self : ResolveAddressStream) -> Unit {
  let ResolveAddressStream(resource) = self
  wasmImportResourceDropResolveAddressStream(resource)
}

///|
pub fn ResolveAddressStream::resolve_next_address(
  self : ResolveAddressStream,
) -> Result[@network.IpAddress?, @network.ErrorCode] {
  let ResolveAddressStream(handle) = self
  let return_area = mbt_ffi_malloc(22)
  wasmImportMethodResolveAddressStreamResolveNextAddress(handle, return_area)
  let lifted1 = match mbt_ffi_load8_u(return_area + 0) {
    0 => {
      let lifted0 : @network.IpAddress? = match
        mbt_ffi_load8_u(return_area + 2) {
        0 => Option::None
        1 => {
          let lifted = match mbt_ffi_load8_u(return_area + 4) {
            0 =>
              @network.IpAddress::Ipv4(
                (
                  mbt_ffi_load8_u(return_area + 6).to_byte(),
                  mbt_ffi_load8_u(return_area + 7).to_byte(),
                  mbt_ffi_load8_u(return_area + 8).to_byte(),
                  mbt_ffi_load8_u(return_area + 9).to_byte(),
                ),
              )
            1 =>
              @network.IpAddress::Ipv6(
                (
                  mbt_ffi_load16_u(return_area + 6)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 8)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 10)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 12)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 14)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 16)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 18)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                  mbt_ffi_load16_u(return_area + 20)
                  .land(0xFFFF)
                  .reinterpret_as_uint(),
                ),
              )
            _ => panic()
          }
          Option::Some(lifted)
        }
        _ => panic()
      }
      Result::Ok(lifted0)
    }
    1 => Result::Err(@network.ErrorCode::from(mbt_ffi_load8_u(return_area + 2)))
    _ => panic()
  }
  mbt_ffi_free(return_area)
  return lifted1
}

///|
pub fn ResolveAddressStream::subscribe(
  self : ResolveAddressStream,
) -> @poll.Pollable {
  let ResolveAddressStream(handle) = self
  let result : Int = wasmImportMethodResolveAddressStreamSubscribe(handle)
  return @poll.Pollable::Pollable(result)
}

///|
pub fn resolve_addresses(
  network : @network.Network,
  name : String,
) -> Result[ResolveAddressStream, @network.ErrorCode] {
  let @network.Network(handle) = network
  let ptr = mbt_ffi_str2ptr(name)
  let return_area = mbt_ffi_malloc(8)
  wasmImportResolveAddresses(handle, ptr, name.length(), return_area)
  let lifted = match mbt_ffi_load8_u(return_area + 0) {
    0 =>
      Result::Ok(
        ResolveAddressStream::ResolveAddressStream(
          mbt_ffi_load32(return_area + 4),
        ),
      )
    1 => Result::Err(@network.ErrorCode::from(mbt_ffi_load8_u(return_area + 4)))
    _ => panic()
  }
  mbt_ffi_free(ptr)
  mbt_ffi_free(return_area)
  return lifted
}
